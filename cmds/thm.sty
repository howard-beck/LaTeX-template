\makeatletter
\newcounter{@thm@depth}
\let\@thm@is@nested\false
\let\@thm@was@nested\false

\let\@old@qedsymbol\qedsymbol
\def\qedsymbol{%
    \ifnum\@thm@is@nested=\true%
        [\expandafter\csname @thm@name@at@\the@thm@depth\endcsname]
    \fi%
    \@old@qedsymbol%
}

% https://tex.stackexchange.com/questions/201956/how-do-i-make-all-the-theorem-alike-environments-have-an-ending-symbol
\renewcommand\@endtheorem{%
    \ifthenelse{\equal{\@thmstylenow}{plain}}%
    {}%
    {%
        {\unskip\nobreak\hfil\penalty50
        \hskip2em\vadjust{}\nobreak\hfil$\triangleleft$
        \parfillskip=0pt \finalhyphendemerits=0 \par
        \penalty 10000 \parskip=0pt\noindent}\ignorespaces
    }%
    \endtrivlist\@endpefalse%
    \addtocounter{@thm@depth}{-1}%
    \ifnum\value{@thm@depth}=0%
        \global\let\@thm@is@nested\false%
    \fi%
}

\def\@thmstylenow{}
\def\@currentthmstyle{plain}
\let\@old@theoremstyle\theoremstyle
\def\theoremstyle#1{%
    \def\@currentthmstyle{#1}
    \@old@theoremstyle{#1}
}

\let\@old@newtheorem\newtheorem
\RenewDocumentCommand{\newtheorem}{m O{} m}{
    \expandafter\let\csname @#1@thmstyle\endcsname\@currentthmstyle
    \@old@newtheorem{#1}[#2]{#3}

    \expandafter\let\csname @old@#1\expandafter\endcsname\csname#1\endcsname%
    \expandafter\def\csname#1\endcsname##1{%
        \expandafter\let\csname @thmstylenow\expandafter\endcsname\csname @#1@thmstyle\endcsname%
        \csname @old@#1\endcsname##1%
        %
        \xdef\@currentlabel{(#3 \thethm)}%
        %
        \ifnum\value{@thm@depth}>0%
            \global\let\@thm@is@nested\true%
        \fi
        \stepcounter{@thm@depth}%
        \expandafter\xdef\csname @thm@name@at@\the@thm@depth\endcsname{#3 \thethm}%
        \label{theorem.\thethm}%
    }%
}
\makeatother

\newtheorem{thm}{Theorem}
\newtheorem{lemma}[thm]{Lemma}
\newtheorem{prop}[thm]{Proposition}
\newtheorem{cor}[thm]{Corollary}
\newtheorem{conjecture}[thm]{Conjecture}
\newtheorem{claim}[thm]{Claim}
\newtheorem{fact}[thm]{Fact}

\theoremstyle{definition}
\newtheorem{defn}[thm]{Definition}
\newtheorem{rmk}[thm]{Remark}
\newtheorem{notation}[thm]{Notation}
\newtheorem{constr}[thm]{Construction}
\newtheorem{rem}[thm]{Reminder}
\newtheorem{intuit}[thm]{Intuition}

\newtheorem{question}[thm]{Question}
\newtheorem{answer}[thm]{Answer}
\newtheorem{example}[thm]{Example}
\newtheorem{nexample}[thm]{Non-Example}

\newtheorem{exer}[thm]{Exercise}

\usepackage[breakable]{tcolorbox}
\newtcolorbox{digression}[1][]{
    width=0.9\linewidth,
    center,
    breakable,
    title={\centering Digression}
}